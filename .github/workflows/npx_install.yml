name: iobroker npx install Windows 64bit Build

on: [push, pull_request]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}-winnpx
  cancel-in-progress: true

jobs:
  test-windows-install:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 14
    - name: prepare-install
      run: |
        npm link
        cd ..
        mkdir iobroker-inst
        cd iobroker-inst

    - name: prepare-install
      run: |
        npx iobroker

    - name: prepare-fix
      run: |
        cd ..
        cd ioBroker
        npm unlink
        npm install
        npm run make-fix
        Remove-Item "node_modules" -Recurse -Force
        npm link
        cd ..
        cd iobroker-inst

    - name: fix
      run: |
        npx iobroker

    #- name: test
    #  run: node test
